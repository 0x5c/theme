pipeline:
  build:
    image: node:8.1.1
    commands:
      - yarn install
      - yarn run clean
      - yarn run build
      - yarn run release

  release:
    image: plugins/s3
    path_style: true
    strip_prefix: dist/
    source: dist/master.tar.gz
    target: /theme
    when:
      event: [ push ]
      branch: [ master ]

  trigger:
    image: plugins/downstream
    server: https://drone.gitea.io
    repositories:
      - go-gitea/website
      - go-gitea/blog
      - go-gitea/docs
      - go-gitea/redirects
    when:
      event: [ push ]
      branch: [ master ]

  discord:
    image: appleboy/drone-discord
    webhook_id: ${WEBHOOK_ID}
    webhook_token: ${WEBHOOK_TOKEN}
    when:
      event: [ push, tag, pull_request ]
      status: [ changed, failure ]
